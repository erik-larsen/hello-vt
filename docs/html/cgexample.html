<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LibVT: LibVT usage example with Cg instead of GLSL</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="CGExample">LibVT usage example with Cg instead of GLSL </a></h1><div class="fragment"><pre class="fragment"> <span class="keyword">static</span> CGcontext       cgContext;
 <span class="keyword">static</span> CGprofile       cgVertexProfile, cgFragmentProfile;
 <span class="keyword">static</span> CGprogram       cgReadbackVertexProgram, cgReadbackFragmentProgram, cgRenderVertexProgram, cgRenderFragmentProgram;
 <span class="keyword">static</span> CGparameter     cgRenderParamMipBias, cgReadbackParamMipBias, cgRenderParamModelViewMatrix, cgReadbackParamModelViewMatrix, cgReadbackParamMipcalcTexture, cgRenderParamPhysicalTexture, cgRenderParamPageTableTexture;

 <span class="keywordtype">void</span> init() <span class="comment">// called at startup</span>
 {
        <a class="code" href="_lib_v_t_8h.html#a9927a78d7798699e3d951fa899fd26b7" title="Initializes LibVT and must be called previous to all other functions.">vtInit</a>(<span class="stringliteral">&quot;/Path/to/the/tile/dir/&quot;</span>, <span class="stringliteral">&quot;jpg&quot;</span>, 0, 8, 256); <span class="comment">// jpeg tiles, no border, mipchain length 8, and 256x256 tiles</span>

        <span class="keywordtype">string</span> p_s = string(prelude);
        
        <span class="keywordtype">char</span> * rb_v = loadTextFile(<span class="stringliteral">&quot;/Users/julian/Documents/Development/VirtualTexturing/LibVT/readback_vert.cg&quot;</span>);
        <span class="keywordtype">char</span> * rb_f = loadTextFile(<span class="stringliteral">&quot;/Users/julian/Documents/Development/VirtualTexturing/LibVT/readback_frag.cg&quot;</span>);
        <span class="keywordtype">char</span> * rVT_v = loadTextFile(<span class="stringliteral">&quot;/Users/julian/Documents/Development/VirtualTexturing/LibVT/renderVT_vert.cg&quot;</span>);
        <span class="keywordtype">char</span> * rVT_f = loadTextFile(<span class="stringliteral">&quot;/Users/julian/Documents/Development/VirtualTexturing/LibVT/renderVT_frag.cg&quot;</span>);
        
        <span class="keywordtype">string</span> rb_v_s = p_s + string(rb_v);
        <span class="keywordtype">string</span> rb_f_s = p_s + string(rb_f);
        <span class="keywordtype">string</span> rVT_v_s = p_s + string(rVT_v);
        <span class="keywordtype">string</span> rVT_f_s = p_s + string(rVT_f);
                        
        
        <a class="code" href="_lib_v_t_8h.html#a41a8053f6cfc5cf8f827f6b1f89b0efd" title="Prepares the OpenGL resources used by LibVT. It must be called after vtInit() and...">vtPrepare</a>(0, 0); <span class="comment">// pass 0 because we have no opengl shader objects and we don&apos;t need to set the sampler uniforms for the Cg shaders anyway this is done with the prelude</span>
        
        
        cgContext = cgCreateContext();
        cgGLSetDebugMode(CG_FALSE);
        cgSetParameterSettingMode(cgContext, CG_DEFERRED_PARAMETER_SETTING);
        cgGLSetManageTextureParameters(cgContext, <span class="keyword">false</span>);
        cgVertexProfile = cgGLGetLatestProfile(CG_GL_VERTEX);
        cgGLSetOptimalOptions(cgVertexProfile);
        cgFragmentProfile = cgGLGetLatestProfile(CG_GL_FRAGMENT);
        cgGLSetOptimalOptions(cgFragmentProfile);
        
        
        <span class="comment">// readback shader</span>
        cgReadbackVertexProgram = cgCreateProgram(cgContext, CG_SOURCE, rb_v_s.c_str(), cgVertexProfile, <span class="stringliteral">&quot;readback_vert&quot;</span>, NULL);             
        cgGLLoadProgram(cgReadbackVertexProgram);
        
        cgReadbackParamModelViewMatrix = cgGetNamedParameter(cgReadbackVertexProgram, <span class="stringliteral">&quot;ModelViewMatrix&quot;</span>);
                
        
        cgReadbackFragmentProgram = cgCreateProgram(cgContext, CG_SOURCE, rb_f_s.c_str(), cgFragmentProfile, <span class="stringliteral">&quot;readback_frag&quot;</span>, NULL);              
        cgGLLoadProgram(cgReadbackFragmentProgram);
        
        cgReadbackParamMipcalcTexture = cgGetNamedParameter(cgReadbackFragmentProgram, <span class="stringliteral">&quot;mipcalcTexture&quot;</span>);
        cgGLSetTextureParameter(cgReadbackParamMipcalcTexture, vt.mipcalcTexture);
        cgGLEnableTextureParameter(cgReadbackParamMipcalcTexture);
        
        cgReadbackParamMipBias = cgGetNamedParameter(cgReadbackFragmentProgram, <span class="stringliteral">&quot;mip_bias&quot;</span>);
        
        
        
        <span class="comment">// renderVT shader</span>
        cgRenderVertexProgram = cgCreateProgram(cgContext, CG_SOURCE, rVT_v_s.c_str(), cgVertexProfile, <span class="stringliteral">&quot;rendervt_vert&quot;</span>, NULL);             
        cgGLLoadProgram(cgRenderVertexProgram);
        
        cgRenderParamModelViewMatrix = cgGetNamedParameter(cgRenderVertexProgram, <span class="stringliteral">&quot;ModelViewMatrix&quot;</span>);
        
        
        cgRenderFragmentProgram = cgCreateProgram(cgContext, CG_SOURCE, rVT_f_s.c_str(), cgFragmentProfile, <span class="stringliteral">&quot;rendervt_frag&quot;</span>, NULL);              
        cgGLLoadProgram(cgRenderFragmentProgram);
        
        cgRenderParamPhysicalTexture = cgGetNamedParameter(cgRenderFragmentProgram, <span class="stringliteral">&quot;physicalTexture&quot;</span>);
        cgGLSetTextureParameter(cgRenderParamPhysicalTexture, vt.physicalTexture);
        cgGLEnableTextureParameter(cgRenderParamPhysicalTexture);
        
        cgRenderParamPageTableTexture = cgGetNamedParameter(cgRenderFragmentProgram, <span class="stringliteral">&quot;pageTableTexture&quot;</span>);
        cgGLSetTextureParameter(cgRenderParamPageTableTexture, vt.pageTableTexture);
        cgGLEnableTextureParameter(cgRenderParamPageTableTexture);
        
        cgRenderParamMipBias = cgGetNamedParameter(cgRenderFragmentProgram, <span class="stringliteral">&quot;mip_bias&quot;</span>);
        
        
        free(prelude);
        free(rb_v);
        free(rb_f);
        free(rVT_v);
        free(rVT_f);

        renderViewHasBeenResizedOrFovChanged(640, 480, 90.0);
 }

 <span class="keywordtype">void</span> renderViewHasBeenResizedOrFovChanged(<span class="keywordtype">int</span> newW, <span class="keywordtype">int</span> newH, <span class="keywordtype">float</span> newFov) <span class="comment">// called at start and when w/h/fov change</span>
 {
        <span class="keywordtype">float</span> nearPlane = 1.0f, farPlane = 7000.0f;

        <a class="code" href="_lib_v_t_8h.html#a33a38c85152447cf555a7a905353204c" title="Sets up LibVT for usage with current rendering parameters. Must be called once at...">vtReshape</a>(newW, newH, newFov, nearPlane, farPlane);
 }

 <span class="keywordtype">void</span> render() <span class="comment">// called every frame</span>
 {
        cgGLEnableProfile(cgVertexProfile);     
        cgGLEnableProfile(cgFragmentProfile);   
        
                
        <a class="code" href="_lib_v_t_8h.html#a7d4070be203c7f025f0ef21f7b0a49cc" title="Must be called every frame previous to rendering the virtual textured geometry for...">vtPrepareReadback</a>();
        
        cgGLBindProgram(cgReadbackVertexProgram);
        cgGLBindProgram(cgReadbackFragmentProgram);
        
        
        cgGLSetStateMatrixParameter(cgReadbackParamModelViewMatrix, CG_GL_MODELVIEW_PROJECTION_MATRIX, CG_GL_MATRIX_IDENTITY);
        cgSetParameter1f(cgReadbackParamMipBias, <a class="code" href="_lib_v_t_8h.html#af4e213c5d72893725a3490513b17c066" title="Provides the bias that should be used for the float bias for the uniform &amp;quot;mip_bias&amp;quot;...">vtGetBias</a>());
        cgGLEnableTextureParameter(cgReadbackParamMipcalcTexture);  <span class="comment">// dont need Cg messing with texture units pls!</span>
        
        
         renderVirtualTexturedObjects();
        
        <a class="code" href="_lib_v_t_8h.html#a5a89d97f074a77cfd7e49738e8beb933" title="Must be called every frame after rendering the virtual textured geometry for the...">vtPerformReadback</a>();


  <span class="comment">// IN PBO MODE: you can burn a lot of CPU cycles here because the GPU is busy transfering the readback buffer back,</span>
  <span class="comment">//              and if you call vtExtractNeededPages() too &quot;early&quot; it will start by blocking until the transfer is done</span>

        <a class="code" href="_lib_v_t_8h.html#aaf4122a00fc8eef7b2534352407b418c" title="Must be called every frame after vtPerformReadback(). If you do not use vtPrepareReadback()...">vtExtractNeededPages</a>(NULL);  <span class="comment">// turn on PBO readback and move this to the very beginning of the frame to delay the readback until the next frame</span>
        <a class="code" href="_lib_v_t_8h.html#a1b5f0f43f71460c980ec9574ba90d0a2" title="Must be called every frame before rendering the virtual textured geometry for the...">vtMapNewPages</a>();
        
        
        
        cgGLBindProgram(cgRenderVertexProgram);
        cgGLBindProgram(cgRenderFragmentProgram);
        
        
        
        cgGLSetStateMatrixParameter(cgRenderParamModelViewMatrix, CG_GL_MODELVIEW_PROJECTION_MATRIX, CG_GL_MATRIX_IDENTITY);
        cgSetParameter1f(cgRenderParamMipBias, <a class="code" href="_lib_v_t_8h.html#af4e213c5d72893725a3490513b17c066" title="Provides the bias that should be used for the float bias for the uniform &amp;quot;mip_bias&amp;quot;...">vtGetBias</a>());
        
        
        cgGLEnableTextureParameter(cgRenderParamPhysicalTexture);  <span class="comment">// dont need Cg messing with texture units pls!</span>
        cgGLEnableTextureParameter(cgRenderParamPageTableTexture); <span class="comment">// dont need Cg messing with texture units pls!</span>
        
                renderVirtualTexturedObjects();
        
        cgGLDisableProfile(cgVertexProfile);
        cgGLDisableProfile(cgFragmentProfile);
        
        renderSomeOtherObjects();

 }

 <span class="keywordtype">void</span> shutdown() <span class="comment">// called at shutdown</span>
 {
        <a class="code" href="_lib_v_t_8h.html#a6cdbd1da7fa7009e1ca22ec280e7e20f" title="Must be called before the program exits if multithreading is enabled.">vtShutdown</a>();
 }
</pre></div> </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Sun Jun 20 23:49:20 2010 for LibVT by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
